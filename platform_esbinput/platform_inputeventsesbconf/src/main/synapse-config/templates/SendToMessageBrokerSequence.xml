<?xml version="1.0" encoding="UTF-8"?>
<template name="SendToMessageBrokerSequence" xmlns="http://ws.apache.org/ns/synapse">
    <parameter name="mb_url"/>
    <parameter name="mb_user"/>
    <parameter name="mb_pwd"/>
    <parameter name="mb_destination_name"/>
    <parameter name="mb_destination_type"/>
    <sequence>
        <property
            expression="fn:concat('java.naming.provider.url=',$func:mb_url)"
            name="mbUrlValue" scope="default" type="STRING"
            xmlns:ns="http://org.apache.synapse/xsd" xmlns:ns2="http://org.apache.synapse/xsd"/>
        <property
            expression="fn:concat('transport.jms.UserName=',$func:mb_user)"
            name="mbUserValue" scope="default" type="STRING"
            xmlns:ns="http://org.apache.synapse/xsd" xmlns:ns2="http://org.apache.synapse/xsd"/>
        <property
            expression="fn:concat('transport.jms.Password=',$func:mb_pwd)"
            name="mbPwdValue" scope="default" type="STRING"
            xmlns:ns="http://org.apache.synapse/xsd" xmlns:ns2="http://org.apache.synapse/xsd"/>
        <property expression="$func:mb_destination_name"
            name="mbDestinationNameValue" scope="default" type="STRING"
            xmlns:ns="http://org.apache.synapse/xsd" xmlns:ns2="http://org.apache.synapse/xsd"/>
        <property
            expression="fn:concat('transport.jms.DestinationType=',$func:mb_destination_type)"
            name="mbDestinationNameType" scope="default" type="STRING"
            xmlns:ns="http://org.apache.synapse/xsd" xmlns:ns2="http://org.apache.synapse/xsd"/>
        <property name="REST_URL_POSTFIX" scope="axis2" type="STRING" value="remove"/>
        <property name="OUT_ONLY" scope="default" type="STRING" value="true"/>
        <property
            expression="fn:concat('jms:/',fn:get-property('mbDestinationNameValue'))"
            name="PREendpointToSend" scope="default" type="STRING"
            xmlns:ns="http://org.apache.synapse/xsd" xmlns:ns2="http://org.apache.synapse/xsd"/>
        <property name="MIDendpointToSend" scope="default" type="STRING" value="?transport.jms.ConnectionFactoryJNDIName=QueueConnectionFactory&amp;java.naming.factory.initial=org.apache.activemq.jndi.ActiveMQInitialContextFactory&amp;transport.jms.SessionAcknowledgement=CLIENT_ACKNOWLEDGE&amp;transport.jms.SessionTransacted=true&amp;"/>
        <property
            expression="fn:concat(fn:get-property('mbUrlValue'),'&amp;',fn:get-property('mbUserValue'),'&amp;',fn:get-property('mbPwdValue'),'&amp;',fn:get-property('mbDestinationNameType'))"
            name="POSTendpointToSend" scope="default" type="STRING"
            xmlns:ns="http://org.apache.synapse/xsd" xmlns:ns2="http://org.apache.synapse/xsd"/>
        <header
            expression="fn:concat(fn:get-property('PREendpointToSend'),fn:get-property('MIDendpointToSend'),fn:get-property('POSTendpointToSend'))"
            name="To" scope="default"
            xmlns:ns="http://org.apache.synapse/xsd" xmlns:ns2="http://org.apache.synapse/xsd"/>
        <log level="full"/>
        <property action="remove" name="ClientApiNonBlocking" scope="axis2"/>
    </sequence>
</template>
