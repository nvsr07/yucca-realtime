<@pp.dropOutputFile />
<#if stream.persisted?? && stream.persisted ="true">
<@pp.changeOutputFile name="api__deploy__output__"+tenant.code+"__"+source.code_+"_"+stream.code+"__MongoEventFormatter.xml"/>
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
	xmlns:int="http://internal.admin.formatter.event.carbon.wso2.org"
	xmlns:xsd="http://internal.admin.formatter.event.carbon.wso2.org/xsd">
	<soapenv:Header />
	<soapenv:Body>
		<int:deployJsonEventFormatterConfiguration>
			<!--Optional: -->
			<int:eventFormatterName>output__${tenant.code}__${source.code_}__${stream.code}__MongoEventFormatter</int:eventFormatterName>
			<!--Optional: -->
			<int:streamNameWithVersion>output__${tenant.code}__${source.code_}__${stream.code}:1.0.0</int:streamNameWithVersion>
			<!--Optional: -->
			<int:eventAdaptorName>MongoDBOutputEventAdaptor</int:eventAdaptorName>
			<!--Optional: -->
			<int:eventAdaptorType>mongoDB</int:eventAdaptorType>
			<!--Optional: -->
			<int:jsonData>{
			<#if source.type = "Application">
				"sensor": "{{meta_source}}",
			<#elseif source.type = "Device">
				"sensor": "{{meta_source}}",
			<#else>
				"sensor": "internal",								
			</#if>
				"time": {$date: "{{time}}" },
				"idDataset" : -1, 
				"datasetVersion" : -1,
        		"tenantCode" : "${tenant.code}",
				"streamCode" : "${stream.code}",
				"virtualEntityCode" : "${source.code}",
				<#list components as component>
				"${component.code}":<#if component.type = "string">"</#if><#if component.type = "dateTime"> {$date: "{{${component.code}}}" }<#else/>{{${component.code}}}</#if><#if component.type = "string">"</#if><#if component_has_next>,</#if></#list>
				<#list components as component><#if component.type = "longitude"><#assign "longitudeComp"=component.code></#if><#if component.type = "latitude"><#assign "latitudeComp"=component.code></#if></#list>
				<#if longitudeComp?? && latitudeComp??>,"idxLocation":[{{${longitudeComp}}},{{${latitudeComp}}}]</#if>
				}</int:jsonData>
			<!--Zero or more repetitions: -->
			<int:outputPropertyConfiguration>
				<!--Optional: -->
				<xsd:key>username</xsd:key>
				<!--Optional: -->
				<xsd:value>${mongoconnection.user}</xsd:value>
			</int:outputPropertyConfiguration>
			<int:outputPropertyConfiguration>
				<xsd:key>collection</xsd:key>
				<#if source.type=="Feed Tweet">
				<xsd:value>social</xsd:value>
				<#else>
				<xsd:value>measures</xsd:value>
				</#if>
			</int:outputPropertyConfiguration>
			<int:outputPropertyConfiguration>
				<!--Optional: -->
				<xsd:key>password</xsd:key>
				<!--Optional: -->
				<xsd:value>${mongoconnection.password}</xsd:value>
			</int:outputPropertyConfiguration>
			<int:outputPropertyConfiguration>
				<!--Optional: -->
				<xsd:key>database</xsd:key>
				<!--Optional: -->
				<xsd:value>DB_${tenant.code}</xsd:value>
			</int:outputPropertyConfiguration>
			<!--Optional: -->
			<int:dataFrom>inline</int:dataFrom>
			<!--Optional: -->
			<int:mappingEnabled>true</int:mappingEnabled>
		</int:deployJsonEventFormatterConfiguration>
	</soapenv:Body>
</soapenv:Envelope>
</#if>