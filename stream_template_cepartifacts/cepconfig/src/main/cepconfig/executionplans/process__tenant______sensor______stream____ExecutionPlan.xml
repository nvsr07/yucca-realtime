<@pp.dropOutputFile />
<@pp.changeOutputFile name="process__"+tenant.code+"__"+sensor.code_+"_"+stream.code+"__ExecutionPlan.xml" />
<?xml version="1.0" encoding="UTF-8"?>
<executionPlan  name="process__${tenant.code}__${sensor.code_}__${stream.code}__ExecutionPlan" statistics="disable"
  trace="disable" xmlns="http://wso2.org/carbon/eventprocessor">
  <description>Execution plan for ${tenant.code}__${sensor.code}__${stream.code}</description>
  <siddhiConfiguration>
    <property name="siddhi.enable.distributed.processing">false</property>
    <property name="siddhi.persistence.snapshot.time.interval.minutes">0</property>
  </siddhiConfiguration>
  <importedStreams>
    <stream as="input" name="input__${tenant.code}__${sensor.code_}__${stream.code}" version="1.0.0"/>
  </importedStreams>
  <queryExpressions><![CDATA[
<#if stream.published?? && stream.published = "true">
from input
insert into outputStream;
</#if>

from input#window.time(30 sec) 
select count(time) as numEventsLast30Sec 
output last every 2 sec 
insert into tempOutputStat for all-events; 

from tempOutputStat#window.length(1) 
select numEventsLast30Sec,"" as lastMessage,"" as lastUpdate
output snapshot every 2 sec 
insert into outputStat for all-events 
]]>
</queryExpressions>
  <exportedStreams>
    <stream name="output__${tenant.code}__${sensor.code_}__${stream.code}" valueOf="outputStream" version="1.0.0"/>
	<stream name="output__${tenant.code}__${sensor.code_}__${stream.code}__stat" valueOf="outputStat" version="1.0.0"/>
  </exportedStreams>
</executionPlan>
